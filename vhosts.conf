
Listen 443

SSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES
SSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES

SSLHonorCipherOrder on 

SSLProtocol all -SSLv3
SSLProxyProtocol all -SSLv3

SSLPassPhraseDialog  builtin

SSLSessionCache "shmcb:C:/xampp/apache/logs/ssl_scache(512000)"
SSLSessionCacheTimeout  300


##
## SSL Virtual Host Context
##

<VirtualHost _default_:443>

    DocumentRoot "C:/xampp/htdocs/www"
    ServerName uai.csie.ndhu.edu.tw:443
    ServerAdmin admin@example.com
    ErrorLog "C:/xampp/apache/logs/error.log"
    TransferLog "C:/xampp/apache/logs/access.log"

    SSLEngine on


    SSLCertificateFile "C:/xampp/apache/conf/data/fullchain.pem"

    SSLCertificateKeyFile "C:/xampp/apache/conf/data/key.pem"

    <FilesMatch "\.(cgi|shtml|phtml|php)$">
        SSLOptions +StdEnvVars
    </FilesMatch>
    <Directory "C:/xampp/apache/cgi-bin">
        SSLOptions +StdEnvVars
    </Directory>

    BrowserMatch "MSIE [2-5]" \
            nokeepalive ssl-unclean-shutdown \
            downgrade-1.0 force-response-1.0


    CustomLog "C:/xampp/apache/logs/ssl_request.log" \
            "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"

</VirtualHost>                                  



## =================================================================
## VIRTUAL HOST FOR FRONTEND 1: it.parasyst.com -> localhost:7779
## =================================================================
<VirtualHost *:443>
    ServerName it.parasyst.com

    SSLEngine on
    # IMPORTANT: Replace these paths with the actual location of your SSL certificate files
    SSLCertificateFile "C:/xampp/apache/conf/data1/fullchain.pem"
    SSLCertificateKeyFile "C:/xampp/apache/conf/data1/key.pem"
    # SSLCertificateChainFile "C:/xampp/apache/conf/ssl/ca_bundle.crt" # Uncomment if you have a chain file

    # These settings are for the reverse proxy
    ProxyPreserveHost On
    ProxyRequests Off
    
    # These rules are CRUCIAL for Vite's WebSocket (Hot Reloading) to work
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule .* "ws://127.0.0.1:7779%{REQUEST_URI}" [P]

    # Forward all other traffic to the Vue dev server
    ProxyPass / http://127.0.0.1:7779/
    ProxyPassReverse / http://127.0.0.1:7779/

    ErrorLog "C:/xampp/apache/logs/logs1/it-error.log"
    CustomLog "C:/xampp/apache/logs/logs1/it-access.log" common
</VirtualHost>

## =================================================================
## VIRTUAL HOST FOR FRONTEND 2: ti.parasyst.com -> localhost:7778
## =================================================================
<VirtualHost *:443>
    ServerName ti.parasyst.com

    SSLEngine on
    # IMPORTANT: Replace these paths with the actual location of your SSL certificate files
    SSLCertificateFile "C:/xampp/apache/conf/data1/fullchain.pem"
    SSLCertificateKeyFile "C:/xampp/apache/conf/data1/key.pem"
    # SSLCertificateChainFile "C:/xampp/apache/conf/ssl/ca_bundle.crt" # Uncomment if you have a chain file

    ProxyPreserveHost On
    ProxyRequests Off
    
    # Rules for Vite's WebSocket
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule .* "ws://127.0.0.1:7778%{REQUEST_URI}" [P]

    # Forward all other traffic to the Vue dev server
    ProxyPass / http://127.0.0.1:7778/
    ProxyPassReverse / http://127.0.0.1:7778/

    ErrorLog "C:/xampp/apache/logs/logs1/ti-error.log"
    CustomLog "C:/xampp/apache/logs/logs1/ti-access.log" common
</VirtualHost>

## =================================================================
## VIRTUAL HOST FOR BACKEND API: api.parasyst.com -> localhost:7776
## =================================================================
<VirtualHost *:443>
    # IMPORTANT: You should create a domain for your API as well
    ServerName ipa.parasyst.com

    SSLEngine on
    # IMPORTANT: Replace these paths with the actual location of your SSL certificate files
    SSLCertificateFile "C:/xampp/apache/conf/data1/fullchain.pem"
    SSLCertificateKeyFile "C:/xampp/apache/conf/data1/key.pem"
    # SSLCertificateChainFile "C:/xampp/apache/conf/ssl/ca_bundle.crt" # Uncomment if you have a chain file
    
    ProxyPreserveHost On
    ProxyRequests Off

    # Forward all traffic to the FastAPI backend
    ProxyPass / http://127.0.0.1:7776/
    ProxyPassReverse / http://127.0.0.1:7776/

    ErrorLog "C:/xampp/apache/logs/logs1/api-error.log"
    CustomLog "C:/xampp/apache/logs/logs1/api-access.log" common
</VirtualHost>
